<template>
  <div class="signal-demo-wrapper">
    <!-- Tesla-style переключатель: Общепит /Фитнес -->
    <div class="signal-theme-toggle">
      <button
        class="signal-theme-btn"
        :class="{ active: selectedTheme === 'cafe' }"
        @click="selectedTheme = 'cafe'"
      >
        Общепит
      </button>
      <button
        class="signal-theme-btn"
        :class="{ active: selectedTheme === 'fitness' }"
        @click="selectedTheme = 'fitness'"
      >
        Фитнес
      </button>
      <div class="signal-theme-slider" :style="{ left: sliderLeft }"></div>
    </div>

    <!-- Переключатель: Эмоции / Факты / Решение -->
    <div class="signal-demo__header">
      <div class="signal-demo__switch" role="tablist">
        <button
          v-for="section in sections"
          :key="section.id"
          class="signal-demo__switch-btn"
          :class="[isActive(section.id) ? 'is-active' : '', section.id]"
          type="button"
          role="tab"
          :aria-selected="isActive(section.id)"
          @click="selectedSection = section.id"
        >
          {{ section.title }}
        </button>
      </div>
    </div>

    <!-- ГЛАВНЫЙ КОНТЕНТ — НА ВСЮ ШИРИНУ -->
    <div class="signal-form-content">
      <!-- Эмоции -->
      <div v-if="selectedSection === 'emotions'" class="signal-question-block" :style="{ '--accent-color': colors.emotions }">
        <p class="signal-direction-label">Эмоции и чувства</p>
        <div class="signal-rotating-phrase-container">
          <transition name="fade" mode="out-in">
            <p :key="currentQuestion1" class="signal-question-label">{{ currentQuestion1 }}</p>
          </transition>
        </div>
        <textarea
          v-model="form.emotionalRelease"
          @focus="startRotation(1)"
          rows="3"
          :placeholder="placeholders.emotions"
          required>
        </textarea>
        <div class="signal-suggestions-container">
          <div
            v-for="suggestion in currentSuggestions.emotions"
            :key="suggestion"
            class="signal-suggestion-bubble signal-emotion-bubble"
            @click="selectSuggestion('emotionalRelease', suggestion, 'emotions')"
          >
            {{ suggestion }}
          </div>
          <div
            v-if="showResetButton('emotions')"
            class="signal-suggestion-bubble signal-reset-bubble signal-emotion-bubble"
            @click="resetSuggestions('emotions')"
          >
            ← Ещё варианты
          </div>
        </div>
        <p class="signal-example-hint" v-html="examples.emotions"></p>
      </div>

      <!-- Факты -->
      <div v-if="selectedSection === 'facts'" class="signal-question-block" :style="{ '--accent-color': colors.facts }">
        <p class="signal-direction-label">Детали проблемы</p>
        <div class="signal-rotating-phrase-container">
          <transition name="fade" mode="out-in">
            <p :key="currentQuestion2" class="signal-question-label">{{ currentQuestion2 }}</p>
          </transition>
        </div>
        <textarea
          v-model="form.factualAnalysis"
          @focus="startRotation(2)"
          rows="3"
          :placeholder="placeholders.facts"
          required>
        </textarea>
        <div class="signal-suggestions-container">
          <div
            v-for="suggestion in currentSuggestions.facts"
            :key="suggestion"
            class="signal-suggestion-bubble signal-fact-bubble"
            @click="selectSuggestion('factualAnalysis', suggestion, 'facts')"
          >
            {{ suggestion }}
          </div>
          <div
            v-if="showResetButton('facts')"
            class="signal-suggestion-bubble signal-reset-bubble signal-fact-bubble"
            @click="resetSuggestions('facts')"
          >
            ← Ещё варианты
          </div>
        </div>
        <p class="signal-example-hint" v-html="examples.facts"></p>
      </div>

      <!-- Решение -->
      <div v-if="selectedSection === 'solutions'" class="signal-question-block" :style="{ '--accent-color': colors.solutions }">
        <p class="signal-direction-label">Предложение решения</p>
        <div class="signal-rotating-phrase-container">
          <transition name="fade" mode="out-in">
            <p :key="currentQuestion3" class="signal-question-label">{{ currentQuestion3 }}</p>
          </transition>
        </div>
        <textarea
          v-model="form.constructiveSuggestions"
          @focus="startRotation(3)"
          rows="3"
          :placeholder="placeholders.solutions"
          required>
        </textarea>
        <div class="signal-suggestions-container">
          <div
            v-for="suggestion in currentSuggestions.solutions"
            :key="suggestion"
            class="signal-suggestion-bubble signal-solution-bubble"
            @click="selectSuggestion('constructiveSuggestions', suggestion, 'solutions')"
          >
            {{ suggestion }}
          </div>
          <div
            v-if="showResetButton('solutions')"
            class="signal-suggestion-bubble signal-reset-bubble signal-solution-bubble"
            @click="resetSuggestions('solutions')"
          >
            ← Ещё варианты
          </div>
        </div>
        <p class="signal-example-hint" v-html="examples.solutions"></p>
      </div>
    </div>
  </div>
</template>

<script setup>
import { reactive, ref, computed, watch, onUnmounted } from 'vue';

// === Режимы ===
const selectedTheme = ref('cafe'); // 'cafe' | 'fitness'

// === Секции ===
const sections = [
  { id: 'emotions', title: 'Эмоции' },
  { id: 'facts', title: 'Факты' },
  { id: 'solutions', title: 'Решение' }
];
const selectedSection = ref('emotions');
const isActive = (id) => id === selectedSection.value;

// === Конфиги (БЕЗ suggestions) ===
const configs = {
  cafe: {
    colors: { emotions: '#A972FF', facts: '#3DDC84', solutions: '#FFB800' },
    placeholders: {
      emotions: 'Или напишите своими словами ...',
      facts: 'Несколько фактов: что и когда произошло ...',
      solutions: 'Дайте честный совет ...'
    },
    examples: {
      emotions: 'Пример: «Кофе был <b>холодный</b>, а бариста <b>не обратил внимания</b>»',
      facts: 'Пример: «Заказ на два капучино <b>ждал 22 минуты</b>, хотя в кафе был почти один»',
      solutions: 'Пример: «Добавить на кассе <b>таймер</b>, чтобы бариста видел <b>время ожидания</b>»'
    },
    questions: {
      1: ['Что вы почувствовали?', 'Какие эмоции испытали?', 'Что расстроило?', 'Что порадовало?'],
      2: ['Что именно произошло?', 'Какие детали важны?', 'Опишите факты'],
      3: ['Что можно сделать лучше?', 'Как исправить?', 'Ваши предложения?']
    },
    suggestions: {
  emotions: {
    initial: ['довольна', 'восхищена', 'благодарна', 'спокойна', 'удивлена', 'расстроена', 'разочарована', 'недовольна', 'возмущена'],

    'довольна': ['чистотой', 'сервисом', 'качеством', 'атмосферой', 'вниманием'],
    'восхищена': ['профессионализмом', 'дизайном', 'скоростью', 'вкусом', 'подходом'],
    'благодарна': ['за внимание', 'за компенсацию', 'за помощь', 'за улыбку', 'за рекомендацию'],
    'спокойна': ['всё стандартно', 'нет проблем', 'привычно', 'ничего не раздражает', 'всё ровно'],
    'удивлена': ['таким сервисом', 'быстротой', 'качеством', 'вниманием', 'ценой'],
    'расстроена': ['долго ждала', 'грязная посуда', 'холодный кофе', 'грубый персонал', 'забыли заказ'],
    'разочарована': ['качеством', 'сервисом', 'ожиданиями', 'атмосферой', 'чистотой'],
    'недовольна': ['обслуживанием', 'очередью', 'ошибкой в заказе', 'температурой блюд', 'упаковкой'],
    'возмущена': ['антисанитарией', 'хамством', 'обманом', 'некачественной едой', 'инородными предметами'],

    // Уровень 2
    'чистотой': ['грязные столы', 'липкий пол', 'немытая посуда', 'пыль везде', 'антисанитария'],
    'сервисом': ['медленный', 'невнимательный', 'равнодушный', 'непрофессиональный', 'хаотичный'],
    'качеством': ['хуже чем обычно', 'не соответствует цене', 'испортилось за месяц', 'как в фастфуде', 'совсем не то'],
    'атмосферой': ['шумно и грязно', 'неуютно', 'холодно', 'плохая музыка', 'неприятные запахи'],
    'вниманием': ['не поздоровались', 'игнорировали', 'не спросили', 'не проверили', 'не улыбнулись'],

    'профессионализмом': ['бариста знает кофе', 'официант помнит заказ', 'повара на высоте', 'все чётко', 'видно опыт'],
    'дизайном': ['красивые чашки', 'стильные столики', 'приятный свет', 'декор', 'интерьер'],
    'скоростью': ['кофе за 3 минуты', 'заказ через 5 мин', 'не ждала', 'быстро принесли', 'оперативно'],
    'вкусом': ['идеальный латте', 'вкусный десерт', 'свежая выпечка', 'отличный соус', 'вкусно как дома'],
    'подходом': ['индивидуально', 'понимают клиента', 'гибкие', 'идут навстречу', 'чуткие'],

    'за внимание': ['спросили как дела', 'пожелали хорошего дня', 'улыбнулись', 'поблагодарили', 'запомнили имя'],
    'за компенсацию': ['вернули деньги', 'дали десерт', 'скидку', 'новый кофе', 'извинились'],
    'за помощь': ['помогли с выбором', 'подсказали', 'объяснили', 'рекомендовали', 'показали'],
    'за улыбку': ['искренне', 'тепло', 'дружелюбно', 'заразительно', 'радушно'],
    'за рекомендацию': ['что взять', 'новое меню', 'сезонное', 'по вкусу', 'по диете'],

    'всё стандартно': ['ничего выдающегося', 'как всегда', 'нормально', 'без сюрпризов', 'привычно'],
    'нет проблем': ['всё гладко', 'без задержек', 'работает', 'ничего не ломалось', 'всё по плану'],
    'привычно': ['как в прошлый раз', 'знакомый вкус', 'тот же сервис', 'ничего нового', 'стабильно'],
    'ничего не раздражает': ['тихо', 'чисто', 'вежливо', 'комфортно', 'спокойно'],
    'всё ровно': ['без эмоций', 'средне', 'нормально', 'ни хорошо ни плохо', 'стандарт'],

    'таким сервисом': ['впервые такое', 'не ожидала', 'шокирована', 'не верю', 'ужасно'],
    'быстротой': ['меньше 5 минут', 'мгновенно', 'рекорд', 'не успела сесть', 'супер'],
    'качеством': ['на высоте', 'идеально', 'свежее', 'вкусно', 'как в рекламе'],
    'вниманием': ['запомнили заказ', 'спросили имя', 'пожелали дня', 'поблагодарили', 'улыбнулись'],
    'ценой': ['дешевле чем думала', 'акция', 'выгодно', 'приятный сюрприз', 'не дорого'],

    'долго ждала': ['20 минут', '30 минут', 'более часа', 'без объяснений', 'видя пустую кофейню'],
    'грязная посуда': ['следы помады', 'остатки еды', 'жирные пятна', 'засохший кофе', 'странный запах'],
    'холодный кофе': ['едва тёплый', 'совсем остыл', 'подали холодным', 'остыл пока ждала', 'температура комнатная'],
    'грубый персонал': ['не поздоровались', 'хамили', 'игнорировали', 'были раздражены', 'повысили голос'],
    'забыли заказ': ['через 40 минут', 'не записали', 'потеряли чек', 'не передали на кухню', 'сидела и ждала'],

    'обслуживанием': ['долгое ожидание', 'путаница в заказах', 'невежливость', 'игнорирование', 'ошибки кассира'],
    'очередью': ['не двигалась', 'час стояла', 'нет системы', 'хаос', 'всех пропускают'],
    'ошибкой в заказе': ['не тот напиток', 'забыли позицию', 'неправильный размер', 'другой сироп', 'перепутали'],
    'температурой блюд': ['холодные', 'остывшие', 'чуть тёплые', 'не разогрели', 'ледяные'],
    'упаковкой': ['протекающие крышки', 'слабые пакеты', 'разорвалась', 'неудобная', 'грязная'],

    'антисанитарией': ['грязные руки', 'упал и подали', 'на полу готовят', 'мухи', 'тараканы'],
    'хамством': ['нагрубили', 'оскорбили', 'накричали', 'показали характер', 'послали'],
    'обманом': ['не тот объем', 'обвесили', 'скрыли стоимость', 'навязали', 'обсчитали'],
    'некачественной едой': ['испорченная', 'несвежая', 'странный вкус', 'горькая', 'кислая'],
    'инородными предметами': ['волосы в еде', 'пластик в круассане', 'проволока', 'нитки', 'жук'],

    // Уровень 3
    'грязные столы': ['крошки', 'жир', 'липко', 'не протирали', 'от предыдущих гостей'],
    'липкий пол': ['от пролитого', 'не мыли', 'скользко', 'опасно', 'не убирали'],
    'немытая посуда': ['разводы', 'запах', 'остатки еды', 'не отмыли', 'грязные ложки'],
    'бариста знает кофе': ['рассказал про зерно', 'подобрал по вкусу', 'объяснил разницу', 'дал попробовать', 'эксперт'],
    'кофе за 3 минуты': ['с 14:10 до 14:13', 'быстро', 'не ждала', 'идеально', 'рекорд'],
    'спросили как дела': ['по-настоящему', 'улыбнулись', 'запомнили имя', 'пожелали дня', 'тепло'],
    'меньше 5 минут': ['4:30 по таймеру', 'быстрее всех', 'не успела сесть', 'впечатляет', 'рекорд'],
    '20 минут': ['засекала по телефону', 'с 14:00 до 14:20', 'другие ушли', 'кофейня пустая', 'без объяснений'],
    'следы помады': ['на чашке', 'красная', 'от предыдущей', 'не помыли', 'противно'],
    'едва тёплый': ['40 градусов', 'можно пить сразу', 'не обжигает', 'остыл', 'не по стандарту'],
    'не поздоровались': ['прошли мимо', 'не посмотрели', 'игнор', 'не улыбнулись', 'холодно'],
    'через 40 минут': ['с 12:00 до 12:40', 'подходила дважды', 'не извинились', 'потеряли заказ', 'ужас'],
    'волосы в еде': ['длинный чёрный', 'в салате', 'на булочке', 'в супе', 'противно'],
    'пластик в круассане': ['твёрдый кусок', 'чуть не сломала зуб', 'опасно', 'не проверили', 'жалоба']
  },

  facts: {
    initial: ['ожидание', 'ошибка в заказе', 'качество блюд', 'чистота', 'персонал'],

    'ожидание': ['20 минут', '30 минут', 'более часа', 'забыли заказ', 'очередь не двигалась'],
    'ошибка в заказе': ['не тот напиток', 'не доложили позицию', 'неправильный соус', 'перепутали объём', 'другое молоко'],
    'качество блюд': ['холодный кофе', 'невкусная еда', 'чёрствая выпечка', 'комочки в матче'],
    'чистота': ['грязная посуда', 'волосы в еде', 'грязная уборная', 'насекомые', 'пластик в круассане'],
    'персонал': ['грубость', 'невнимательность', 'некомпетентность', 'трогали еду руками', 'не извинились'],

    // Уровень 2
    '20 минут': ['засекала по часам', 'спросила у соседнего стола', 'заказала в 14:30, получила в 14:50', 'долгое ожидание для простого заказа', 'других обслужили быстрее'],
    '30 минут': ['полчаса точно', 'с 15:00 до 15:30', 'дважды подходила узнать', 'время на телефоне показало', 'успела прочитать новости'],
    'более часа': ['час и 10 минут', 'полтора часа ждала', 'с 12:00 до 13:15', 'весь обед потратила', 'опоздала на встречу'],
    'забыли заказ': ['не записали', 'потеряли чек', 'не передали на кухню', 'перепутали с другим', 'готовила не то'],
    'очередь не двигалась': ['стояла полчаса', 'один кассир на всех', 'касса сломалась', 'менялись местами', 'хаос'],

    'не тот напиток': ['заказала латте, принесли капучино', 'просила без сахара, был сладкий', 'хотела большой, дали маленький', 'другой сироп добавили', 'обычное молоко вместо овсяного'],
    'не доложили позицию': ['забыли десерт', 'нет половины заказа', 'пропали сэндвичи', 'только кофе принесли', 'блинчики не было'],
    'неправильный соус': ['положили не тот соус к тыквенным панкейкам', 'острый вместо сладкого', 'майонез вместо сметаны', 'кетчуп забыли', 'соус отдельно не дали'],
    'перепутали объём': ['несоответствие объема напитков', 'маленький вместо большого', 'дали меньше чем заказала', 'размер не тот', 'обманули с порцией'],
    'другое молоко': ['обычное вместо овсяного', 'соевое вместо миндального', 'с лактозой дали', 'не предупредили', 'аллергия может быть'],

    'холодный кофе': ['градусов 40-50', 'можно было пить сразу', 'не обжигал язык', 'как будто стоял долго', 'температура комнатная'],
    'невкусная еда': ['пересоленная', 'недосоленная', 'горькая', 'кислая', 'странный вкус'],
    'чёрствая выпечка': ['как камень', 'вчерашняя', 'сухая', 'твёрдая', 'невозможно откусить'],
    'комочки в матче': ['комочки в матче', 'не размешали', 'порошок не растворился', 'комки муки', 'неоднородная масса'],

    'грязная посуда': ['на чашке помада', 'жирные разводы на тарелке', 'крошки от предыдущих гостей', 'капли кофе на блюдце', 'следы от губной помады'],
    'волосы в еде': ['чёрный волос в редисе', 'длинный волос в салате', 'волосы на булочке', 'в супе волос', 'противно есть'],
    'грязная уборная': ['не убирали', 'бумаги нет', 'воняет', 'лужи на полу', 'грязь везде'],
    'насекомые': ['тараканы бегают', 'муха в кофе', 'жук в салате', 'паук на стене', 'противно смотреть'],
    'пластик в круассане': ['кусочек пластика в круассане', 'твёрдый кусок', 'чуть не сломала зуб', 'опасно', 'могла подавиться'],

    'грубость': ['не поздоровались', 'ответили резко', 'закатили глаза', 'проигнорировали вопрос', 'были явно недовольны'],
    'невнимательность': ['не слушали', 'переспрашивали', 'отвлекались', 'забыли просьбу', 'записали неправильно'],
    'некомпетентность': ['не знали меню', 'не умели готовить', 'путались в кнопках', 'долго соображали', 'спрашивали у коллег'],
    'трогали еду руками': ['трогали трубочку грязными руками', 'лапали булочки', 'без перчаток', 'грязными руками', 'неаккуратно'],
    'не извинились': ['даже не извинились', 'было все равно', 'сделали вид что нормально', 'проигнорировали', 'сказали что так и надо'],

    // Уровень 3
    'засекала по часам': ['телефон показал', 'скриншот', 'видео', 'свидетели', 'точно 20 минут'],
    'заказала в 14:30, получила в 14:50': ['чек с временем', 'фото чека', 'другие видели', 'не торопились', 'кофейня пустая'],
    'не записали': ['устно сказала', 'не повторили', 'не внесли в систему', 'потеряли', 'не передали'],
    'заказала латте, принесли капучино': ['просила без пены', 'принесли с пеной', 'другой вкус', 'не то', 'ошибка'],
    'градусов 40-50': ['измерила термометром', 'едва тёплый', 'не по ГОСТу', 'не обжигает', 'остыл'],
    'на чашке помада': ['красная', 'от предыдущей', 'не помыли', 'противно', 'жалоба'],
    'чёрный волос в редисе': ['длинный', 'в салате', 'не мой', 'не заметили', 'антисанитария'],
    'не поздоровались': ['прошли мимо', 'не посмотрели', 'игнор', 'холодно', 'невежливо']
  },

  solutions: {
    initial: ['таймер ожидания', 'обучение персонала', 'контроль качества', 'система проверки', 'стандарты сервиса'],

    'таймер ожидания': ['визуальный контроль бариста/старшего бариста', 'с номерами заказов', 'видимый гостям', 'контроль времени', 'сигналы на баре', 'обратная связь от гостей'],
    'обучение персонала': ['по сервису', 'по санитарии', 'по качеству', 'по коммуникации', 'регулярные тренинги'],
    'контроль качества': ['проверка блюд', 'температурный контроль', 'свежесть продуктов', 'упаковка', 'дегустация'],
    'система проверки': ['чек-лист качества', 'двойная проверка', 'контроль чистоты', 'стандарты подачи', 'фото блюд'],
    'стандарты сервиса': ['вежливость', 'скорость', 'точность', 'чистота', 'профессионализм'],

    // Уровень 2
    'визуальный контроль бариста/старшего бариста': ['песочные часы на стойке', 'отчёты по среднему времени заказа', 'замеры скорости обслуживания менеджером', 'сравнение с нормой', 'обсуждение на пятиминутке'],
    'с номерами заказов': ['в мобильном приложении', 'на чеке QR-код', 'на чеке номер заказа'],
    'видимый гостям': ['в мобильном приложении', 'на чеке QR-код', 'на чеке номер заказа'],
    'контроль времени': ['стандарт 7 минут', 'красная зона после 10 мин', 'автоотсчёт от момента пробития чека'],
    'сигналы на баре': ['цветовые индикаторы готовности', 'звуковой таймер для бариста'],
    'обратная связь от гостей': ['опрос о времени ожидания', 'кнопка "долго жду" в приложении', 'комментарий в чеке QR-кодом'],

    'по сервису': ['тренинги вежливости', 'ролевые игры', 'работа с жалобами', 'стандарты общения', 'мотивация персонала'],
    'по санитарии': ['мытье посуды', 'уборка столов', 'проверка чистоты', 'гигиена рук', 'контроль температуры'],
    'по качеству': ['дегустация напитков', 'проверка ингредиентов', 'температура подачи', 'внешний вид блюд', 'сроки годности'],
    'по коммуникации': ['активное слушание', 'решение конфликтов', 'извинения и компенсации', 'позитивное общение', 'работа с негативом'],
    'регулярные тренинги': ['раз в месяц', 'новых сотрудников', 'переаттестация', 'мастер-классы', 'обмен опытом'],

    'проверка блюд': ['перед подачей', 'температура напитков', 'внешний вид', 'соответствие заказу', 'свежесть ингредиентов'],
    'температурный контроль': ['термометр для кофе', '85-90 градусов', 'горячие блюда', 'холодные напитки', 'контроль каждый час'],
    'свежесть продуктов': ['ежедневная поставка', 'сроки годности', 'ротация товара', 'маркировка даты', 'утилизация просрочки'],
    'упаковка': ['герметичные крышки', 'качественные пакеты', 'стаканы не протекают', 'салфетки в комплекте', 'удобная переноска'],
    'дегустация': ['каждая партия', 'новые рецепты', 'мнение гостей', 'тестирование вкуса', 'корректировка рецептур'],

    'чек-лист качества': ['для каждого заказа', 'проверка температуры', 'чистота посуды', 'правильность состава', 'время подачи'],
    'двойная проверка': ['готовящая и подающая', 'кассир и бариста', 'менеджер и персонал', 'фото готового блюда', 'подпись ответственной'],
    'контроль чистоты': ['каждый час', 'чек-лист уборки', 'дезинфекция', 'мытье рук', 'чистая форма'],
    'стандарты подачи': ['правильная посуда', 'украшение блюд', 'салфетки и приборы', 'температура подачи', 'презентация'],
    'фото блюд': ['перед подачей', 'контроль качества', 'обучение персонала', 'соцсети', 'архив образцов'],

    'вежливость': ['приветствие с улыбкой', 'благодарность гостье', 'извинения за ошибки', 'помощь в выборе', 'прощание'],
    'скорость': ['стандарт 10 минут', 'быстрое принятие заказа', 'оперативная готовка', 'мгновенная подача', 'ускоренная оплата'],
    'точность': ['записывать заказы', 'повторять вслух', 'проверять чек', 'уточнять детали', 'контроль состава'],
    'чистота': ['мытье рук каждые 30 мин', 'чистая форма', 'дезинфекция поверхностей', 'порядок на рабочем месте', 'свежая посуда'],
    'профессионализм': ['знание меню', 'умение готовить', 'решение проблем', 'работа в команде', 'развитие навыков'],

    // Уровень 3
    'песочные часы на стойке': ['3 минуты', 'видно всем', 'дисциплина', 'контроль', 'прозрачно'],
    'стандарт 7 минут': ['от пробития чека', 'до подачи', 'норма', 'KPI', 'мониторинг'],
    'термометр для кофе': ['цифровой', 'точность 0.1°', 'проверка каждой чашки', 'стандарт 85-90°', 'обучение'],
    'ежедневная поставка': ['утром', 'свежие продукты', 'проверка при приёмке', 'контроль сроков', 'надёжный поставщик'],
    'приветствие с улыбкой': ['обязательно', 'искренне', 'по имени', 'пожелание дня', 'стандарт'],
    'записывать заказы': ['в блокнот', 'в планшет', 'повторять вслух', 'уточнять', 'без ошибок']
  }
}
  },
  fitness: {
    colors: { emotions: '#A972FF', facts: '#3DDC84', solutions: '#FFB800' },
    placeholders: {
      emotions: 'Или напишите своими словами ...',
      facts: 'Несколько фактов: что и когда произошло ...',
      solutions: 'Дайте честный совет ...'
    },
    examples: {
      emotions: 'Пример: «Тренажёр <b>сломан</b>, а администратор <b>не помог</b>»',
      facts: 'Пример: «Тренер опоздал на <b>15 минут</b>, группа ждала у двери»',
      solutions: 'Пример: «Поставить <b>таймер на двери</b>, чтобы опоздания были видны всем»'
    },
    questions: {
      1: ['Что вы почувствовали?', 'Какие эмоции испытали?', 'Что расстроило?', 'Что порадовало?'],
      2: ['Что именно произошло?', 'Какие детали важны?', 'Опишите факты'],
      3: ['Что можно сделать лучше?', 'Как исправить?', 'Ваши предложения?']
    },
    suggestions: {
  emotions: {
    initial: [
      'довольна', 'восхищена', 'благодарна', 'спокойна', 'удивлена',
      'расстроена', 'разочарована', 'недовольна', 'возмущена'
    ],

    'довольна': [
      'чистотой клуба', 'отзывчивостью персонала', 'качеством оборудования',
      'атмосферой пространства', 'гибким расписанием'
    ],
    'восхищена': [
      'профессионализмом тренера', 'дизайном клуба', 'организацией процессов',
      'мотивацией персонала', 'современными тренажёрами'
    ],
    'благодарна': [
      'за решение проблемы', 'за индивидуальный подход', 'за поддержку новичков',
      'за внимательное отношение', 'за рекомендации по тренировкам'
    ],
    'спокойна': [
      'обычная тренировка', 'стандартный сервис', 'нет ярких впечатлений',
      'привычная атмосфера', 'нет проблем'
    ],
    'удивлена': [
      'новыми услугами', 'изменениями в расписании', 'появлением новых тренажёров',
      'нестандартным подходом тренера', 'быстрой реакцией персонала'
    ],
    'расстроена': [
      'переполненностью зала', 'грубостью тренера', 'грязными раздевалками',
      'ощущением неловкости', 'затруднённым доступом к оборудованию'
    ],
    'разочарована': [
      'подходом персонала', 'ожиданиями от клуба', 'уровнем тренировок',
      'расписанием занятий', 'стоимостью абонемента'
    ],
    'недовольна': [
      'оборудованием', 'очередью на тренажёры', 'ошибкой в абонементе',
      'температурой в зале', 'чистотой душевых'
    ],
    'возмущена': [
      'антисанитарией', 'хамством администратора', 'обманом в оплате',
      'опасными тренажёрами', 'токсичной атмосферой'
    ]
  },

  facts: {
    initial: [
      'опоздание тренера', 'переполненный зал', 'грязь в раздевалке',
      'неисправное оборудование', 'ошибка в абонементе', 'ошибка персонала',
      'ощущение неловкости', 'антисанитария', 'очередь на тренажёры'
    ],

    // Ключевые факты для жалоб. Примеры по каждому сценарию
    'чистотой клуба': [
      'раздевалка пахнет свежо', 'пол всегда сухой', 'уборка 2 раза в день',
      'чистые души', 'нет запаха пота'
    ],
    'отзывчивостью персонала': [
      'помогли с техникой', 'ответили в чате', 'решили вопрос за минуту',
      'запомнили имя', 'поддержали при жалобе'
    ],
    'качеством оборудования': [
      'новые тренажёры', 'всё работает', 'нет неудобной посадки',
      'регулярное обслуживание', 'есть современные системы'
    ],
    'атмосферой пространства': [
      'нет очередей', 'уютное освещение', 'музыка поднимает настроение',
      'все зоны свободны', 'открытый доступ к душу'
    ],
    'гибким расписанием': [
      'группы утром и вечером', 'онлайн-запись', 'занятия без отмены',
      'всегда есть свободные слоты', 'замена без штрафа'
    ],

    'профессионализмом тренера': [
      'разъясняет техники', 'даёт обратную связь', 'управляет группой',
      'настраивает программу', 'предотвращает травмы'
    ],
    'дизайном клуба': [
      'много света', 'просторные залы', 'стильная зона отдыха',
      'интерактивные табло', 'есть зона coworking'
    ],
    'организацией процессов': [
      'электронные ключи', 'оператор на входе', 'быстрая оплата',
      'нет бумажных очередей', 'идеальный контроль доступности'
    ],
    'мотивацией персонала': [
      'инициирует welcome-тренировки', 'отмечает успехи клиентов',
      'делает тематические челленджи', 'регулярная обратная связь',
      'создаёт приятную атмосферу'
    ],
    'современными тренажёрами': [
      'виртуальный инструктор', 'поддержка Bluetooth', 'настройка под рост и вес',
      'встроенные датчики', 'групповой режим'

    ],

    'за решение проблемы': [
      'компенсация услугой', 'вернули деньги', 'оперативно устранили',
      'заменили тренера', 'бонус за неудобство'
    ],
    'за индивидуальный подход': [
      'разработка плана под возраст', 'смена группы', 'рекомендация врача',
      'индивидуальный тариф', 'дополнительная поддержка'
    ],
    'за поддержку новичков': [
      'показали технику', 'ввели в курс правил', 'дали инструктаж',
      'ответили на вопросы', 'сопровождали в залы'
    ],
    'за внимательное отношение': [
      'помнят имя', 'поздравили с результатом', 'предложили бонус',
      'отметили на доске успеха', 'дали индивидуальные рекомендации'
    ],
    'за рекомендации по тренировкам': [
      'составили план восстановления', 'дали советы по питанию',
      'объяснили выбор упражнений', 'рекомендовали массаж', 'направили на анализ нагрузок'
    ],

    // Примеры проблем
    'переполненностью зала': [
      'нет свободных мест', 'давка в кардио-зоне', 'очередь к тренеру',
      'превышен лимит посещений', 'длинная очередь'
    ],
    'грубостью тренера': [
      'грубо разговаривал', 'игнорировал форму', 'давал непрофессиональные советы',
      'отделывал одного клиента', 'критиковал группу'
    ],
    'грязными раздевалками': [
      'грязь в душе', 'разбросанные вещи', 'нет чистых ковриков',
      'запах сырости', 'не выносят мусор'
    ],
    'ощущением неловкости': [
      'все смотрят', 'стеснение раздеться', 'нет шторок', 'нет зоны для переодевания', 'сложная атмосфера'
    ],
    'затруднённым доступом к оборудованию': [
      'тренажёры всегда заняты', 'ожидание 20 минут', 'нет альтернатив',
      'таймеры не работают', 'длинная очередь'
    ],
    'подходом персонала': [
      'не помогли в проблеме', 'общение формальное', 'нет советов',
      'раздражённо отвечали', 'избегали контакта'
    ],
    'ожиданиями от клуба': [
      'получил не то, что ожидал', 'завышенные ожидания', 'по отзывам был лучше',
      'цена не оправдала', 'обещали больше услуг'
    ],
    'уровнем тренировок': [
      'нет индивидуальности', 'повторяют старый план', 'нет развития',
      'одни и те же упражнения', 'не мотивирует'
    ],
    'расписанием занятий': [
      'занятий мало', 'отменяют без причины', 'группы переполнены',
      'удобного времени нет', 'трудно записаться'
    ],
    'стоимостью абонемента': [
      'дорого', 'много доплат', 'не возвращают деньги', 'нет разовых тарифов',
      'высокая стоимость'
    ],
    'оборудованием': [
      'старое оборудование', 'скрипят тренажёры', 'сломаны ручки',
      'нет новых моделей', 'центральный блок не работает'
    ],
    'очередью на тренажёры': [
      'жду уже 10 минут', 'таймер не работает', 'предварительная запись не помогает', 'нет админа', 'очередь не двигается'
    ],
    'ошибкой в абонементе': [
      'оплата прошла дважды', 'данные не синхронизируются', 'блокировка без причины',
      'ошибка тарифа', 'не отображается в личном кабинете'
    ],
    'температурой в зале': [
      'очень жарко', 'нет проветривания', 'сквозняки', 'нет кондиционера',
      'потею больше нормы'
    ],
    'чистотой душевых': [
      'грязная плитка', 'нет мыла', 'вода на полу', 'нет полотенец',
      'плесень на стенах'
    ],
    'антисанитарией': [
      'грязные полотенца', 'нет дезинфекции', 'мусор под скамейками',
      'тараканы', 'грязь в душе'
    ],
    'хамством администратора': [
      'грубо ответили', 'отказали без причины', 'разговаривали на повышенных тонах',
      'оскорбили', 'не объяснили причину отказа'
    ],
    'обманом в оплате': [
      'не вернули деньги', 'навязали доп услуги', 'ошибка тарифа',
      'не предупредили о списании', 'скрытые платежи'
    ],
    'опасными тренажёрами': [
      'выбитые болты', 'нет стопоров', 'ослаблен крепёж', 'плохая фиксация', 'риск травмы'
    ],
    'токсичной атмосферой': [
      'группа не поддерживает', 'постоянные соревнования', 'критика вместо обратной связи',
      'дискриминация новичков', 'игнорируют мнение клиентов'
    ]
  },

  solutions: {
    initial: [
      'таймер начала занятий', 'онлайн-запись на тренажёры', 'чек-лист уборки',
      'система жалоб', 'разделение зон', 'расширение расписания',
      'контроль очереди', 'замена тренера', 'компенсация'
    ],

    // Решения для всех жалоб
    'таймер начала занятий': [
      'уведомление всех участников', 'электронный таймер', 'штраф тренеру за опоздание',
      'автоматическая отмена при опоздании', 'контроль по камерам'
    ],
    'онлайн-запись на тренажёры': [
      'тайм-слот на каждые 30 минут', 'очередь в приложении', 'резервирование в реальном времени',
      'уведомления о доступности', 'автоматическое освобождение'
    ],
    'чек-лист уборки': [
      'уборка каждые 2 часа', 'отметка в приложении', 'фотоотчёт чистоты', 'проверка менеджером', 'замена грязных полотенец'
    ],
    'система жалоб': [
      'QR-код для обращения', 'онлайн-чат с администратором', 'коробка предложений', 'анонимно', 'ответ в течение часа'
    ],
    'разделение зон': [
      'отдельные площади для разных групп', 'разметка на полу', 'очередь только на кардио', 'зоны отдыха вне тренажёров', 'табло свободных зон'
    ],
    'расширение расписания': [
      'добавить группы утром и вечером', 'использовать опрос клиентов для времени', 'найти доп. тренеров', 'онлайн-календарь', 'добавить wellness-направления'
    ],
    'контроль очереди': [
      'специальный сотрудник', 'электронная очередь', 'уведомления при доступности', 'статистика загруженности', 'таймер для каждого тренажёра'
    ],
    'замена тренера': [
      'назначить другого специалиста', 'выбрать тренера из предложенных', 'экстренная замена при жалобе', 'провести дополнительное обучение', 'отследить качество по оценкам'
    ],
    'компенсация': [
      'продление абонемента', 'бонус тренировка', 'скидка 20% на месяц', 'перевод на другой тариф', 'подарок клиенту'
    ]
  }
}
  }
};

// === Текущая конфигурация ===
const currentConfig = computed(() => configs[selectedTheme.value]);
const colors = computed(() => currentConfig.value.colors);
const placeholders = computed(() => currentConfig.value.placeholders);
const examples = computed(() => currentConfig.value.examples);

// === Форма ===
const form = reactive({
  emotionalRelease: '',
  factualAnalysis: '',
  constructiveSuggestions: ''
});

// === Подсказки ===
const suggestions = reactive({ emotions: {}, facts: {}, solutions: {} });
const currentSuggestions = reactive({ emotions: [], facts: [], solutions: [] });
const selectedSuggestions = reactive({ emotions: [], facts: [], solutions: [] });
const initialFiltered = reactive({ emotions: [], facts: [], solutions: [] });
const isAtInitial = reactive({ emotions: true, facts: true, solutions: true });

// === Вопросы ===
const currentQuestion1 = ref('');
const currentQuestion2 = ref('');
const currentQuestion3 = ref('');
let rotationInterval = null;

// === Слайдер ===
const sliderLeft = computed(() => selectedTheme.value === 'cafe' ? '6px' : 'calc(50% + 6px)');

// === Сброс ===
watch(selectedTheme, () => {
  resetAll();
}, { immediate: true });

function resetAll() {
  const cfg = currentConfig.value;
  Object.keys(form).forEach(k => form[k] = '');

  Object.keys(suggestions).forEach(type => {
    suggestions[type] = { ...cfg.suggestions[type] };
    const init = cfg.suggestions[type]?.initial || [];
    initialFiltered[type] = [...init];
    currentSuggestions[type] = [...init];
    selectedSuggestions[type] = [];
    isAtInitial[type] = true;
  });

  currentQuestion1.value = cfg.questions[1][0];
  currentQuestion2.value = cfg.questions[2][0];
  currentQuestion3.value = cfg.questions[3][0];
  selectedSection.value = 'emotions';
  clearInterval(rotationInterval);
}

// === Логика подсказок ===
function showResetButton(type) {
  return !isAtInitial[type] && currentSuggestions[type].length > 0;
}

function resetSuggestions(type) {
  const filtered = initialFiltered[type].filter(word => !selectedSuggestions[type].includes(word));
  currentSuggestions[type] = filtered.length > 0 ? [...filtered] : [...initialFiltered[type]];
  isAtInitial[type] = true;
}

// === ВЫБОР ПОДСКАЗКИ: ПЕРВОЕ СЛОВО И ПОСЛЕ ТОЧКИ — ЗАГЛАВНЫЕ ===
function selectSuggestion(field, suggestion, type) {
  const text = form[field].trim();
  const isFirstWord = !text;
  const isAfterDot = text.endsWith('.');
  
  let word;
  if (isFirstWord || isAfterDot) {
    word = suggestion.charAt(0).toUpperCase() + suggestion.slice(1).toLowerCase();
  } else {
    word = suggestion.toLowerCase();
  }

  form[field] = text ? `${text} ${word}` : word;

  if (!selectedSuggestions[type].includes(suggestion)) {
    selectedSuggestions[type].push(suggestion);
  }

  isAtInitial[type] = false;
  updateSuggestions(type, suggestion);
}

// === ОБНОВЛЕНИЕ ПОДСКАЗОК: ТОЧКА В КОНЦЕ ЦЕПОЧКИ ===
function updateSuggestions(type, word) {
  const next = suggestions[type][word];
  if (next && next.length > 0) {
    currentSuggestions[type] = next.filter(item => !selectedSuggestions[type].includes(item));
  } else {
    // КОНЕЦ ЦЕПОЧКИ — СТАВИМ ТОЧКУ
    const lastField = type === 'emotions' ? 'emotionalRelease' :
                      type === 'facts' ? 'factualAnalysis' : 'constructiveSuggestions';
    const text = form[lastField].trim();
    if (text && !text.endsWith('.')) {
      form[lastField] = `${text}.`;
    }
    resetSuggestions(type);
  }
}

// === Ротация вопросов ===
function startRotation(num) {
  clearInterval(rotationInterval);
  const questions = currentConfig.value.questions[num];
  let index = 0;
  const set = (i) => {
    if (num === 1) currentQuestion1.value = questions[i];
    if (num === 2) currentQuestion2.value = questions[i];
    if (num === 3) currentQuestion3.value = questions[i];
  };
  set(index);
  rotationInterval = setInterval(() => {
    index = (index + 1) % questions.length;
    set(index);
  }, 3000);
}

onUnmounted(() => clearInterval(rotationInterval));
</script>

<style scoped>
/* РАСТЯНУТО НА ВСЮ ШИРИНУ VITEPRESS */
.signal-demo-wrapper {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  width: 100%;
  max-width: none;
  margin: 0;
  padding: 1rem 0;
}

/* Отступ между переключателями */
.signal-theme-toggle {
  margin-bottom: 1.5rem;
}

/* Tesla-style переключатель */
.signal-theme-toggle {
  position: relative;
  display: flex;
  width: 100%;
  background: #2a2a2e;
  border-radius: 16px;
  padding: 6px;
  overflow: hidden;
}
.signal-theme-btn {
  flex: 1;
  padding: 12px 16px;
  background: transparent;
  border: none;
  color: #ccc;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: color 0.3s ease;
  z-index: 2;
}
.signal-theme-btn.active {
  color: #000;
  font-weight: 700;
}
.signal-theme-slider {
  position: absolute;
  top: 6px;
  bottom: 6px;
  left: 6px;
  width: calc(50% - 12px);
  background: #fff;
  border-radius: 12px;
  transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 1;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

/* Переключатель Эмоции/Факты/Решение */
.signal-demo__header {
  display: flex;
  justify-content: center;
  margin-bottom: 1.5rem;
}
.signal-demo__switch {
  display: flex;
  gap: 8px;
  padding: 0;
  background: transparent;
  border: none;
}
.signal-demo__switch-btn {
  appearance: none;
  border: 2px solid #2c2c2f;
  background: transparent;
  color: #f0f0f0;
  padding: 8px 14px;
  border-radius: 10px;
  font-size: 0.95em;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.15s ease;
}
.signal-demo__switch-btn.emotions.is-active { background: rgba(169,114,255,0.14); border-color: #A972FF; color: #A972FF; }
.signal-demo__switch-btn.facts.is-active { background: rgba(61,220,132,0.14); border-color: #3DDC84; color: #3DDC84; }
.signal-demo__switch-btn.solutions.is-active { background: rgba(255,184,0,0.14); border-color: #FFB800; color: #FFB800; }

/* ГЛАВНЫЙ КОНТЕНТ */
.signal-form-content {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.signal-question-block {
  background-color: #2a2a2e;
  border-radius: 16px;
  padding: 1.25rem;
  border: 1px solid #3a3a3e;
  border-left: 4px solid var(--accent-color);
}

.signal-direction-label {
  font-weight: 600;
  font-size: 0.75rem;
  color: #888;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 0.5rem;
}
.signal-rotating-phrase-container {
  height: 52px;
  margin-bottom: 0.75rem;
  overflow: hidden;
}
.signal-question-label {
  font-weight: 500;
  font-size: 1rem;
  margin: 0;
  color: #f0f0f0;
  line-height: 1.3;
}

textarea {
  width: 100%;
  background-color: #242426;
  border: 1px solid #444;
  border-radius: 10px;
  padding: 0.75rem 1rem;
  font-size: 0.95rem;
  color: #f0f0f0;
  transition: all 0.3s ease;
  resize: vertical;
}
textarea:focus {
  outline: none;
  border-color: var(--accent-color);
  background-color: #2a2a2e;
  box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent-color) 20%, transparent);
}
::placeholder { color: #666; }

.signal-suggestions-container {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin: 0.75rem 0 0.5rem;
}
.signal-suggestion-bubble {
  padding: 0.35rem 0.85rem;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
  border: 1px solid transparent;
}
.signal-emotion-bubble { background: rgba(169,114,255,0.1); border-color: rgba(169,114,255,0.3); color: #A972FF; }
.signal-emotion-bubble:hover { background: #A972FF; color: #000; }
.signal-fact-bubble { background: rgba(61,220,132,0.1); border-color: rgba(61,220,132,0.3); color: #3DDC84; }
.signal-fact-bubble:hover { background: #3DDC84; color: #000; }
.signal-solution-bubble { background: rgba(255,184,0,0.1); border-color: rgba(255,184,0,0.3); color: #FFB800; }
.signal-solution-bubble:hover { background: #FFB800; color: #000; }
.signal-reset-bubble { font-weight: 600; opacity: 0.8; font-size: 0.75rem; border-style: dashed !important; }
.signal-reset-bubble:hover { opacity: 1; }

.signal-example-hint {
  font-size: 0.8rem;
  color: #777;
  margin: 0.5rem 0 0 0.25rem;
  line-height: 1.2;
}
.signal-example-hint b { color: #aaa; font-weight: 600; }

.fade-enter-active, .fade-leave-active { transition: opacity 0.5s ease; }
.fade-enter-from, .fade-leave-to { opacity: 0; }
</style>
